{% extends "base.html.twig" %}

{% block title %}FORUM IMMOBILIER{% endblock %}
{% block body %}
<ul class="nav nav-tabs">
  <li class="nav-item">
    <a class="nav-link active" href="#resultatspublications">Publications et articles</a>
  </li>
  <li class="nav-item">
    <a class="nav-link active" href="#resultatsutilisateurs">Utilisateurs</a>
  </li>
</ul>
<br/><br/><br/><br/>
{# ------------------------------------------------------------------------------------------------------
------------------------------RESULTATS DE LA BARRE DE RECHERCHE PUBLICATIONS ET ARTICLES---------------
------------------------------------------------------------------------------------------------------ #}

   {# Affichez les résultats si le formulaire est soumis #}
    {% if app.request.query.has('keyword') %}
        {# Traitez la recherche et affichez les résultats ici #}
        <h2 id="resultatspublications">Résultats des Publications et Articles ({{ publicationResults|length }}): </h2><br/>
            
                {# publicationResults est défini dans HomeController, provient de la fonction de recherche dans le Repository PUblication #}
                {% if publicationResults is empty %}
                    <ul>
                        <p>Aucun résultat trouvé.</p>
                    </ul>
                {% else %}
                    <ul>   
                        <div class="grillePublications">            
                            {% for publication in publicationResults %}
                                {% if publication.contenu or publication.titre is defined %}
                                    {% include 'components/_publications.html.twig' %}
                                {% endif %}
                            {% endfor %}
                         </div>
                    </ul>
                {% endif %}
           
    {% endif %}
{# ----------------------------------------------------------------------------------------------------
------------------------------------FIN DES RESULTATS DE LA BARRE DE RECHERCHE -----------------------
--------------------------------------PUBLICATIONS ET ARTICLES----------------------------------------
------------------------------------------------------------------------------------------------------ 



{# ------------------------------------------------------------------------------------------------------
------------------------------RESULTATS DE LA BARRE DE RECHERCHE PROFILS UTILISATEURS---------------
------------------------------------------------------------------------------------------------------ #}                                 
    {% if app.request.query.has('keyword') %}
        {# Traitez la recherche et affichez les résultats ici #}
        <h2 id="resultatsutilisateurs">Résultats Profils Utilisateurs ({{ userResults|length }}) : </h2><br/>
        {# userResults est défini dans HomeController, provient de la fonction de recherche dans le Repository User #}
        {% if userResults is empty %}
            <ul>
                <p>Aucun résultat trouvé.</p>
            </ul>
        {% else %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Pseudo</th>
                        <th>Roles</th>
                        <th>Prénom Nom</th>
                        <th>Métier</th>
                        <th>Inscrit depuis le </th>
                        {% if is_granted('ROLE_ADMIN') %} 
                            <th>Id</th>
                            <th>Email</th>
                            <th>Actif</th>
                            <th>AcceptationCgu</th>
                            <th>Newsletter</th>
                            <th>UpdatedAt</th>
                            <th>DeletedAt</th>
                            <th>actions</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for user in userResults %}
                        <tr>
                            <td><a href="{{ path('app_profile_show', {'id': user.id}) }}">{{ user.Pseudo }}</a></td>
                            <td>
                                {% if 'ROLE_PARTENAIRE' in user.roles %}Partenaire {% endif %}
                                {% if 'ROLE_MEMBRE' in user.roles %}Membre {% endif %}
                                {% if 'ROLE_ADMIN' in user.roles %}Admin {% endif %}
                            </td>
                            <td>
                                {% if 'ROLE_MEMBRE' in user.roles %}
                                    {% if user.membre.prenom and user.membre.nom is not empty %}
                                        {{user.membre.prenom}} {{user.membre.nom}}
                                    {% endif %}
                                {% endif %}

                                {% if 'ROLE_PARTENAIRE' in user.roles %}
                                    {% if user.partenaire.prenom and user.partenaire.nom is not empty %}
                                        {{user.partenaire.prenom}} {{user.partenaire.nom}}
                                    {% endif %}
                                {% endif %}
                            </td>
                            <td>
                                {% if 'ROLE_PARTENAIRE' in user.roles %}
                                    {{user.partenaire.metier}}(société : {{ user.partenaire.societe }})
                                {% endif %}
                                {% if 'ROLE_MEMBRE' in user.roles %}
                                    {{user.membre.metier}}
                                {% endif %}
                            </td>
                            <td>{{ user.createdAt ? user.createdAt|date('d-m-Y') : '' }}</td>
                            {% if is_granted('ROLE_ADMIN') %} 
                                <td>{{ user.id }}</td>
                                <td>{{ user.email }}</td>
                                
                                <td>{{ user.newsletter ? 'Yes' : 'No' }}</td>
                                <td>{{ user.acceptationCgu ? 'Yes' : 'No' }}</td>
                                <td>{{ user.actif ? 'Yes' : 'No' }}</td>
                                
                                <td>{{ user.updatedAt ? user.updatedAt|date('Y-m-d H:i:s') : '' }}</td>
                                <td>{{ user.deletedAt ? user.deletedAt|date('Y-m-d H:i:s') : '' }}</td>
                                <td>
                                    <a href="{{ path('app_profile_edit', {'id': user.id}) }}">edit</a>
                                    <a href="{{ path('app_profile_password', {'id': user.id}) }}">password</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="12">no records found</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    {% endif %}

    {# ----------------------------------------------------------------------------------------------------
------------------------------------FIN DES RESULTATS DE LA BARRE DE RECHERCHE -----------------------
-----------------------------------------PROFILS UTILISATEURS----------------------------------------
------------------------------------------------------------------------------------------------------ #}




    {# ----------------------------------------------------------------------------------------------------
------------------------------------FIN DES RESULTATS DE LA BARRE DE RECHERCHE -----------------------
------------------------------------------------------------------------------------------------------ #}

{% endblock %}

